VPC
#Formula to calculate the IPaddress
#Create a VPC
#Create subnets
#Create a RT and associate Subnets
#Create a IGW
#NAT gateway
#VPC peering



##How to calculate the IP address
Formula to count the IP address available
- 10.0.0.0/8  :- 2 ^ (32-8)   2^24 :- 16777216
- 10.0.0.0/16 :- 2 ^ (32-16)  2^16 :- 65536
- 10.0.0.0/24 :- 2 ^ (32-24)  2^8  :- 256
- 10.0.0.0/32 :- 2 ^ (32-32)  2^0  :- 1

Notes:-
- subnets cannot clash between each other
- whenever we create IP address in amazon 5 IP address are reserved for internal usage.
   - First 4 and last 1 Ip address 


subnets
-----------
5 IPs will be reserved 
10.0.1.0 :- For Network
10.0.1.1 :- AWS routing 
10.0.1.2 :- AWS DNS
10.0.1.3 :- for AWS Future purpose
10.0.1.255 :- Boradcasting




Route tables
------------
For Each VPC a route table will be created. // Default route table.
Two route table for public and other for private route table.
if there is no route table created All the subnets will be associated with default RT

Subnet Association
- Click on the RT, enable the association of subnets

One subnet can only have 1 RT, But I


Internet Gateway
-----------------
Which allows routes from VPC to internet
THere can one IGW to one VPC which can be attached one 1VPCs


NAT gateway
-------------
Managed instance
Launched in the public IP 
NAT gateways helps all the internet bound traffic from pvt instances to internet and replies back.
Example:- DB server which requires the patches.

whenever you delete the NAT GW, before removing the route in PVT RT you will see something called backhole.


Modify Auto assign the public IP address
------------------------------------------
so when instances are  launched it get public subnet they get public IP address.


Enable DNS hostname and DNS resolutions
---------------------------------------------
At VPC level Enable the DNS resolutions and DNS hostanmaes
Provides internet to Private instances
Create a NAT gateway in the public subnet and associate a new public ot that.

Now add a new route to private RT withe source as 0.0.0.0/0 to NAT gateway.



VPC peering.
--------------
why peering:- we connect 2 VPCS
- Two departments under the same organization want to talk each other
- company bought another company  which is in different Account.

Without VPC peering they can talk to each other but they have to go via public subnets.

whenever we create a vpc peering, owners of the VPC have to confirm the request, VPC can be same account or different account But conditions is they have to be in same region.


Conditions
- No overlapping IP ranges 2 VPCs
- No transitive peering, IGW access across VPCs
     -if VPC A connects to B and VPC B connects to C , it does not mean A can connected C
     - IGW in VPC A cannot be shared to VPC B
     - No NAT routing between the VPCs


# TO peer the VPCs

Step 1
a.Click on the peering connection 
- Enter the First VPC and choose "MyAccount/other Account" and Enter the destination VPC 
b.Accept th peering connection

Step 2:
Edit the RT of First VPC add route saying::-
CIDR of Destionation VPC  to VPC-peering ID

and 

Edit the Destination VPC and route saying
CIDR of source VPC to VPC peering


VPC Endpoints
-------------
A VPC endpoints enable private connections between VPC and supported AWS services
- They dont require 
- Direct connect 
- NAT gateway
- VPN connection
- internet gateway

There are two types of VPC endpoints
- Interface endpoints
- Gateway endpoints.

what is the meaning of ENDpoints:
endpoint:- it could be an interation points for communications
It could be a URL where your service can be access by a client application


Gateway endpoints;- DynamoDB and s3 which uses the route tables
Elastic Endpoints:- Kinesis :- which uses the ENI


Notes:
try to connect a s3 from a private instances

https://www.youtube.com/watch?v=CMrFIv3a29w
Step1;-
Click the Endpoints, search for s3 in the drop down and select the private route table 
which will automatically add a route to private route table.
